{"version":3,"sources":["../../src/pages/scanqr/scanqr.module.ts","../../src/pages/scanqr/scanqr.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ScanqrPage } from './scanqr';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ScanqrPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ScanqrPage),\r\n  ],\r\n})\r\nexport class ScanqrPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scanqr/scanqr.module.ts","import { Storage } from '@ionic/storage';\r\nimport { HttpProvider } from './../../providers/http/http';\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, LoadingController, Platform } from 'ionic-angular';\r\nimport { QRScanner, QRScannerStatus } from '@ionic-native/qr-scanner';\r\nimport { Device } from '@ionic-native/device';\r\n\r\n\r\n/**\r\n * Generated class for the ScanqrPage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage({\r\n    name: 'scanqr'\r\n})\r\n@Component({\r\n    selector: 'page-scanqr',\r\n    templateUrl: 'scanqr.html',\r\n})\r\nexport class ScanqrPage {\r\n\r\n\r\n\r\n    scanData: string;\r\n    constructor(public navCtrl: NavController, public navParams: NavParams, private qrScanner: QRScanner, private http: HttpProvider, private loadingController: LoadingController, private storage: Storage, private device: Device, private platform: Platform) {\r\n    }\r\n\r\n    Scan() {\r\n        if (this.platform.is('cordova')) {\r\n            this.qrScanner.prepare()\r\n                .then((status: QRScannerStatus) => {\r\n                    if (status.authorized) {\r\n                        // camera permission was granted\r\n                        let ionApp = <HTMLElement>document.getElementsByTagName(\"ion-app\")[0];\r\n\r\n                        // start scanning\r\n                        let scanSub = this.qrScanner.scan().timeout(60000).subscribe((text: string) => {\r\n                            //alert(text);\r\n                            let loading = this.loadingController.create({\r\n                                content: \"กำลังเชื่อมต่อกับระบบ กรุณารอสักครู่...\",\r\n                            });\r\n                            loading.present();\r\n\r\n                            this.scanData = text;\r\n                            let userID = this.scanData.slice(0, 7);\r\n                            let password = this.scanData.slice(7);\r\n\r\n                            this.storage.get('userInfo').then((user) => {\r\n                                if (user.USERID != userID) {\r\n\r\n                                    this.storage.remove('EA');\r\n                                    this.storage.remove('userInfo');\r\n                                    this.storage.remove('sn1');\r\n                                    this.storage.remove('sn22');\r\n\r\n                                }\r\n                            });\r\n\r\n\r\n                            this.qrScanner.hide(); // hide camera preview\r\n                            scanSub.unsubscribe(); // stop scanning\r\n                            ionApp.style.display = \"block\";\r\n                            // this.navCtrl.push('createpassword', { 'userID': userID, 'password': password }, { animate: false });\r\n\r\n                            this.http.login(userID, password).subscribe(result => {\r\n                                //console.log(JSON.stringify(result.json()));\r\n                                loading.dismiss();\r\n\r\n                                if (JSON.stringify(result.json()) == '[]') {\r\n                                    alert('รหัสพนักงาน หรือ รหัสผ่าน ไม่ถูกต้อง');\r\n                                }\r\n                                else {\r\n                                    let u = result.json();\r\n                                    let info = {\r\n                                        tablet_sn: this.device.serial,\r\n                                        user_id: userID\r\n                                    }\r\n                                    //console.log(info);\r\n                                    this.http.updateTablet(info).subscribe(result => {\r\n                                        //console.log(result)\r\n                                    });\r\n                                    this.storage.set(\"userInfo\", u[0]).then(() => this.navCtrl.push('createpassword', { 'userInfo': result.json() }, { animate: false }));\r\n\r\n\r\n                                }\r\n                            });\r\n                        });\r\n\r\n                        // show camera preview\r\n                        ionApp.style.display = \"none\";\r\n                        this.qrScanner.show();\r\n                        // setTimeout(() => {\r\n                        //     ionApp.style.display = \"block\";\r\n                        //     scanSub.unsubscribe(); // stop scanning\r\n                        //     this.qrScanner.hide();\r\n                        //   }, 5000);\r\n                        // wait for user to scan something, then the observable callback will be called\r\n\r\n                    } else if (status.denied) {\r\n                        // camera permission was permanently denied\r\n                        // you must use QRScanner.openSettings() method to guide the user to the settings page\r\n                        // then they can grant the permission from there\r\n                    } else {\r\n                        // permission was denied, but not permanently. You can ask for permission again at a later time.\r\n                    }\r\n                })\r\n                .catch((e: any) => console.log('Error is', e));\r\n\r\n\r\n        } else {\r\n            this.http.login(\"1050001\", \"1234\").subscribe(result => {\r\n                //console.log(JSON.stringify(result.json()));\r\n                this.storage.remove('EA');\r\n                this.storage.remove('userInfo');\r\n                this.storage.remove('sn1');\r\n                this.storage.remove('sn22');\r\n\r\n                if (JSON.stringify(result.json()) == '[]') {\r\n                    alert('รหัสพนักงาน หรือ รหัสผ่าน ไม่ถูกต้อง');\r\n                }\r\n                else {\r\n                    let u = result.json();\r\n                    this.storage.set(\"userInfo\", u[0]).then(() => this.navCtrl.push('createpassword', { 'userInfo': result.json() }, { animate: false }));\r\n\r\n\r\n                }\r\n            });\r\n        }\r\n    }\r\n    Back() {\r\n        this.navCtrl.popToRoot();\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scanqr/scanqr.ts"],"sourceRoot":""}